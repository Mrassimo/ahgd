graph TB
    %% AHGD ETL Pipeline Data Lineage Overview
    %% This diagram shows the high-level data flow from sources to final outputs
    
    classDef sourceNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef extractorNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef transformerNode fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef validatorNode fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef loaderNode fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef outputNode fill:#f1f8e9,stroke:#33691e,stroke-width:3px
    
    %% External Data Sources
    subgraph "External Data Sources"
        AIHW[("üè• AIHW<br/>Australian Institute<br/>of Health & Welfare")]
        ABS[("üìä ABS<br/>Australian Bureau<br/>of Statistics")]
        BOM[("üå§Ô∏è BOM<br/>Bureau of<br/>Meteorology")]
        Medicare[("üíä Medicare PBS<br/>Pharmaceutical<br/>Benefits Scheme")]
    end
    
    %% Extraction Layer
    subgraph "Extraction Layer"
        AIHWExt[AIHW Extractors<br/>‚Ä¢ Mortality Data<br/>‚Ä¢ Hospital Data<br/>‚Ä¢ Health Indicators<br/>‚Ä¢ Medicare Utilisation]
        ABSExt[ABS Extractors<br/>‚Ä¢ Geographic Boundaries<br/>‚Ä¢ Census Demographics<br/>‚Ä¢ SEIFA Indices<br/>‚Ä¢ Postcode Mappings]
        BOMExt[BOM Extractors<br/>‚Ä¢ Climate Data<br/>‚Ä¢ Weather Stations<br/>‚Ä¢ Environmental Indicators]
        MedExt[Medicare Extractors<br/>‚Ä¢ PBS Data<br/>‚Ä¢ Prescription Patterns]
    end
    
    %% Raw Data Storage
    subgraph "Raw Data Storage"
        RawData[(üóÑÔ∏è data_raw/<br/>‚Ä¢ CSV Files<br/>‚Ä¢ JSON Files<br/>‚Ä¢ Geospatial Data)]
    end
    
    %% Transformation Layer
    subgraph "Transformation Layer"
        GeoTrans[Geographic Standardiser<br/>‚Ä¢ Coordinate Systems<br/>‚Ä¢ Boundary Processing<br/>‚Ä¢ SA2 Mapping]
        DataInt[Data Integrator<br/>‚Ä¢ Source Harmonisation<br/>‚Ä¢ Conflict Resolution<br/>‚Ä¢ Quality Assessment]
        DerivedInd[Derived Indicators<br/>‚Ä¢ Health Metrics<br/>‚Ä¢ Risk Factors<br/>‚Ä¢ Composite Indices]
        Denorm[Denormaliser<br/>‚Ä¢ Flatten Hierarchies<br/>‚Ä¢ Export Optimisation]
    end
    
    %% Validation Layer
    subgraph "Validation Layer"
        SchemaVal[Schema Validation<br/>‚Ä¢ Data Types<br/>‚Ä¢ Field Constraints<br/>‚Ä¢ Business Rules]
        GeoVal[Geographic Validation<br/>‚Ä¢ Boundary Consistency<br/>‚Ä¢ Spatial Relationships<br/>‚Ä¢ Coordinate Validation]
        StatVal[Statistical Validation<br/>‚Ä¢ Outlier Detection<br/>‚Ä¢ Distribution Analysis<br/>‚Ä¢ Quality Metrics]
        QualCheck[Quality Checker<br/>‚Ä¢ Completeness<br/>‚Ä¢ Consistency<br/>‚Ä¢ Accuracy Assessment]
    end
    
    %% Master Data Creation
    subgraph "Integrated Data Processing"
        MasterRec[üéØ MasterHealthRecord<br/>Creation Pipeline<br/>‚Ä¢ SA2-Level Integration<br/>‚Ä¢ Complete Health Profiles]
    end
    
    %% Export Layer
    subgraph "Export & Loading Layer"
        ProdLoader[Production Loader<br/>‚Ä¢ Multi-format Export<br/>‚Ä¢ Compression<br/>‚Ä¢ Partitioning]
    end
    
    %% Final Outputs
    subgraph "Final Data Products"
        Parquet[(üìã Parquet Files<br/>‚Ä¢ master_health_record.parquet<br/>‚Ä¢ Optimised for Analytics)]
        CSV[(üìÑ CSV Exports<br/>‚Ä¢ Human Readable<br/>‚Ä¢ Excel Compatible)]
        GeoJSON[(üó∫Ô∏è GeoJSON<br/>‚Ä¢ Spatial Data<br/>‚Ä¢ Web Mapping)]
        JSON[(üìù JSON<br/>‚Ä¢ API Consumption<br/>‚Ä¢ Web Applications)]
        Reports[(üìä Quality Reports<br/>‚Ä¢ Validation Results<br/>‚Ä¢ Data Lineage)]
    end
    
    %% Data Flow Connections
    AIHW --> AIHWExt
    ABS --> ABSExt
    BOM --> BOMExt
    Medicare --> MedExt
    
    AIHWExt --> RawData
    ABSExt --> RawData
    BOMExt --> RawData
    MedExt --> RawData
    
    RawData --> GeoTrans
    RawData --> DataInt
    
    GeoTrans --> DerivedInd
    DataInt --> DerivedInd
    DerivedInd --> Denorm
    
    Denorm --> SchemaVal
    SchemaVal --> GeoVal
    GeoVal --> StatVal
    StatVal --> QualCheck
    
    QualCheck --> MasterRec
    
    MasterRec --> ProdLoader
    
    ProdLoader --> Parquet
    ProdLoader --> CSV
    ProdLoader --> GeoJSON
    ProdLoader --> JSON
    ProdLoader --> Reports
    
    %% Apply styles
    class AIHW,ABS,BOM,Medicare sourceNode
    class AIHWExt,ABSExt,BOMExt,MedExt extractorNode
    class GeoTrans,DataInt,DerivedInd,Denorm transformerNode
    class SchemaVal,GeoVal,StatVal,QualCheck validatorNode
    class ProdLoader loaderNode
    class MasterRec,Parquet,CSV,GeoJSON,JSON,Reports outputNode