# AHGD ETL Output Documentation

## Overview

This document provides a comprehensive overview of all data outputs generated by the Australian Healthcare Geographic Database (AHGD) ETL pipeline. These outputs form the foundation of the dimensional data model that supports healthcare analytics and reporting.

## Data Warehouse Structure

The AHGD data warehouse follows a star schema design with dimension and fact tables. All data is stored in Apache Parquet format, which provides efficient compression and columnar storage for analytics workloads.

## Dimension Tables

### Geographic Dimension (`geo_dimension.parquet`)

- **Size**: 374 MB
- **Last Updated**: March 29, 2025 21:08
- **Description**: Core geographic dimension containing all geographic boundaries at multiple levels.
- **Key Columns**:
  - `geo_sk`: Surrogate key for geographic entities
  - `geo_code`: Natural key/business key for geographic entities (e.g., SA1 codes)
  - `geo_name`: Human-readable name of the geographic area
  - `geo_type`: Type of geographic entity (SA1, SA2, SA3, SA4, LGA, STE)
  - `geo_category`: Category of the geographic entity
  - `state_code`: State/territory code
  - `state_name`: State/territory name
  - `geometry`: Geographic boundary data in WKB format
  - `etl_processed_at`: Timestamp of ETL processing
- **Relationships**: Referenced by all fact tables via `geo_sk`
- **Source**: ABS Geographic Boundaries

### Time Dimension (`dim_time.parquet`)

- **Size**: 31 KB (112 records)
- **Last Updated**: March 29, 2025 21:08
- **Description**: Time dimension with day-level granularity for temporal analysis.
- **Key Columns**:
  - `time_sk`: Surrogate key for time dimension
  - `full_date`: Full date in YYYY-MM-DD format
  - `year`: Year component
  - `quarter`: Quarter of year (1-4)
  - `month`: Month number (1-12)
  - `month_name`: Month name
  - `day_of_month`: Day of month (1-31)
  - `day_of_week`: Day of week (1-7)
  - `day_name`: Day name
  - `financial_year`: Financial year (YYYY-YY)
  - `is_weekday`: Flag indicating if date is weekday
  - `is_census_year`: Flag indicating if date is in a census year
  - `etl_processed_at`: Timestamp of ETL processing
- **Relationships**: Referenced by all fact tables via `time_sk`
- **Source**: Generated time data

### Health Condition Dimension (`dim_health_condition.parquet`)

- **Size**: 2.5 KB (7 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Dimension table for health conditions.
- **Key Columns**:
  - `condition_sk`: Surrogate key for health conditions
  - `condition`: Condition code/identifier
  - `condition_name`: Full name of the health condition
  - `condition_category`: Category of the health condition
  - `etl_processed_at`: Timestamp of ETL processing
- **Relationships**: Referenced by health-related fact tables via `condition_sk`
- **Source**: ABS Census G19, G20, G21 tables

### Demographic Dimension (`dim_demographic.parquet`)

- **Size**: 2.9 KB (2 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Dimension for demographic attributes like age and sex.
- **Key Columns**:
  - `demographic_sk`: Surrogate key for demographics
  - `age_group`: Age group category
  - `sex`: Sex code
  - `sex_name`: Sex name (Male, Female, etc.)
  - `age_min`: Minimum age in group
  - `age_max`: Maximum age in group
  - `etl_processed_at`: Timestamp of ETL processing
- **Relationships**: Referenced by demographic-based fact tables via `demographic_sk`
- **Source**: ABS Census demographic metadata
- **Note**: Totals can be identified by checking if `age_group == 'Tot'` or `sex == 'P'` (Persons)

### Person Characteristic Dimension (`dim_person_characteristic.parquet`)

- **Size**: 3.3 KB (16 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Dimension for person characteristics like country of birth, income, and labour force status.
- **Key Columns**:
  - `characteristic_sk`: Surrogate key
  - `characteristic_type`: Type of characteristic (e.g., CountryOfBirth, LabourForceStatus)
  - `characteristic_code`: Code for characteristic value
  - `characteristic_name`: Human-readable name
  - `characteristic_category`: Category grouping for characteristic
  - `etl_processed_at`: Timestamp of ETL processing
- **Relationships**: Referenced by G21-based fact tables via `characteristic_sk`
- **Source**: ABS Census G21 tables

## Fact Tables

### Population Facts (`fact_population.parquet`)

- **Size**: 470 KB (2,044 records)
- **Last Updated**: March 29, 2025 10:31
- **Description**: Contains population statistics from G01 Census data.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `total_persons`: Total persons count
  - `total_male`: Total male count
  - `total_female`: Total female count
  - `total_indigenous`: Total indigenous persons count
  - `etl_processed_at`: Timestamp of ETL processing
- **Grain**: Geographic entity (various levels) by time
- **Source**: ABS Census G01 tables

### Income Facts (`fact_income.parquet`)

- **Size**: 788 KB (3,069 records)
- **Last Updated**: March 29, 2025 13:18
- **Description**: Contains income statistics from G17 Census data.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `low_income_count`: Count of persons with low income
  - `medium_income_count`: Count of persons with medium income
  - `high_income_count`: Count of persons with high income
  - `income_not_stated_count`: Count of persons with unstated income
- **Grain**: Geographic entity (various levels) by time
- **Source**: ABS Census G17 tables

### Health Conditions Detailed Facts (`fact_health_conditions_detailed.parquet`)

- **Size**: 228 KB (745 records)
- **Last Updated**: March 29, 2025 21:09
- **Description**: Contains detailed health condition statistics from G19/G20 Census data.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `condition`: Health condition identifier
  - `age_group`: Age group
  - `sex`: Sex identifier
  - `count`: Count of persons
- **Grain**: Geographic entity by time by condition by age group by sex
- **Source**: ABS Census G19/G20 detailed tables
- **Note**: This is an intermediate/staging table that uses natural keys (`condition`, `age_group`, `sex`) instead of surrogate keys. It is primarily used for data validation and as a source for the refined fact table.

### Health Conditions Refined Facts (`fact_health_conditions_refined.parquet`)

- **Size**: 228 KB (750 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Contains refined health condition statistics with dimension surrogate keys.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `condition_sk`: Foreign key to health condition dimension
  - `demographic_sk`: Foreign key to demographic dimension
  - `count`: Count of persons
  - `etl_updated_at`: Timestamp of last ETL update
- **Grain**: Geographic entity by time by condition by demographic
- **Source**: Refined version of health conditions fact table with dimension integration
- **Note**: This is the preferred table for analytics and BI tools as it uses surrogate keys for better join performance and referential integrity with dimension tables.

### Health Conditions by Characteristic Facts (`fact_health_conditions_by_characteristic.parquet`)

- **Size**: 227 KB (738 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Contains health condition statistics by person characteristics from G21 Census.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `condition`: Health condition identifier
  - `characteristic_type`: Type of characteristic
  - `characteristic_code`: Code for characteristic value
  - `count`: Count of persons
- **Grain**: Geographic entity by time by condition by characteristic
- **Source**: ABS Census G21 tables
- **Note**: This is an intermediate/staging table that uses natural keys (`condition`, `characteristic_type`, `characteristic_code`) instead of surrogate keys. It is primarily used for data validation and as a source for the refined fact table.

### Health Conditions by Characteristic Refined Facts (`fact_health_conditions_by_characteristic_refined.parquet`)

- **Size**: 226 KB (737 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Contains refined health condition by characteristic statistics with dimension surrogate keys.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `condition_sk`: Foreign key to health condition dimension
  - `characteristic_sk`: Foreign key to person characteristic dimension
  - `count`: Count of persons
  - `etl_updated_at`: Timestamp of last ETL update
- **Grain**: Geographic entity by time by condition by characteristic
- **Source**: Refined version of health conditions by characteristic fact table with dimension integration
- **Note**: This is the preferred table for analytics and BI tools as it uses surrogate keys for better join performance and referential integrity with dimension tables.

### Unpaid Assistance Facts (`fact_unpaid_assistance.parquet`)

- **Size**: 384 KB (1,538 records)
- **Last Updated**: March 29, 2025 21:11
- **Description**: Contains unpaid assistance statistics from G25 Census data.
- **Key Columns**:
  - `geo_sk`: Foreign key to geographic dimension
  - `time_sk`: Foreign key to time dimension
  - `provided_unpaid_care_count`: Count of persons providing unpaid care
  - `did_not_provide_unpaid_care_count`: Count of persons not providing unpaid care
  - `unpaid_care_not_stated_count`: Count of persons with unstated unpaid care status
  - `etl_updated_at`: Timestamp of last ETL update
- **Grain**: Geographic entity by time
- **Source**: ABS Census G25 tables

## Data Model Diagram

```
                   ┌─────────────────┐
                   │  dim_time.parq  │
                   └─────────┬───────┘
                             │
                             │ time_sk
                             │
┌────────────────┐      ┌────┴────────────────────────┐      ┌───────────────────────┐
│dim_demographic.│      │                             │      │dim_health_condition.   │
│     parq       ├──┬──►│    Fact Tables (*.parq)     │◄─┬──┤       parq             │
└────────────────┘  │   │                             │  │  └───────────────────────┘
                    │   └─────────────┬───────────────┘  │
                    │                 │                  │
               demographic_sk         │              condition_sk
                                      │
                                      │ geo_sk
                                      │
                                      ▼
                           ┌─────────────────────┐
                           │ geo_dimension.parq  │
                           └─────────────────────┘
```

## Processing Flow

1. **Extract**: Raw census data extracted from ABS sources
2. **Transform**:
   - Basic transformation for first-level fact tables
   - Dimension table generation
   - Refined fact table creation with surrogate keys
3. **Load**: Final output saved as Parquet files

## Data Quality Considerations

- Geographic code validation ensures proper joining with geographic dimension
- Surrogate keys used in refined fact tables for improved join performance
- ETL timestamps maintained for tracking data freshness
- Consistent naming conventions used across all tables
- All count columns validated to be non-negative integers

## Backup and Archiving

All previous versions of output files are archived before updates to maintain historical versions and ensure recoverability.

## Usage Notes for Data Architects

- The dimensional model follows star schema best practices
- All surrogate keys are integer types for efficient joins
- Parquet format chosen for efficient columnar compression and analytics performance
- The model supports drilling up/down geographic hierarchies via the geo_dimension
- Fact tables use consistent grain definitions to ensure accurate aggregations
